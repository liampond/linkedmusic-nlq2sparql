PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX wdt: <http://www.wikidata.org/prop/direct/>
PREFIX gj: <https://linkedmusic.ca/graphs/theglobaljukebox/>
PREFIX ts: <https://linkedmusic.ca/graphs/thesession/>

SELECT DISTINCT ?song ?songLabel ?country
WHERE {
  # First, find countries with more than 4 sessions in The Session
  {
    SELECT ?country (COUNT(?session) AS ?sessionCount)
    WHERE {
      GRAPH <https://linkedmusic.ca/graphs/thesession/> {
        ?session rdf:type ts:Session .
        ?session wdt:P17 ?country .
      }
    }
    GROUP BY ?country
    HAVING (COUNT(?session) > 4)
  }
  
  # Then find songs from The Global Jukebox from those countries
  GRAPH <https://linkedmusic.ca/graphs/theglobaljukebox/> {
    ?song rdf:type gj:Song .
    ?song wdt:P495 ?country .
    OPTIONAL { ?song rdfs:label ?songLabel . }
  }
}
ORDER BY ?country ?songLabel