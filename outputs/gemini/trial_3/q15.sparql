PREFIX dtl: <https://linkedmusic.ca/graphs/dig-that-lick/>
PREFIX wdt: <http://www.wikidata.org/prop/direct/>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

SELECT ?gender ?genderLabel (COUNT(?solo) AS ?count)
WHERE {
  # Subquery to retrieve Solos and their reconciled Wikidata Artist URIs from the local DTL graph
  {
    SELECT ?solo ?artistWD
    WHERE {
      GRAPH <https://linkedmusic.ca/graphs/dig-that-lick/> {
        # Identify entities that are explicitly typed as dtl:Solo
        ?solo rdf:type dtl:Solo .
        
        # Follow the performer property to the local artist entity
        ?solo wdt:P175 ?artist .
        
        # Follow the reconciliation link to the Wikidata Q-ID
        ?artist wdt:P2888 ?artistWD .
      }
    }
  }

  # Federated query to retrieve the gender from Wikidata using the identified Q-IDs
  SERVICE <https://query.wikidata.org/sparql> {
    ?artistWD wdt:P21 ?gender .
    
    # Retrieve the label for the gender
    ?gender rdfs:label ?genderLabel .
    FILTER(LANG(?genderLabel) = "en")
  }
}
GROUP BY ?gender ?genderLabel